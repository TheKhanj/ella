#!/usr/bin/env bash

. inc/common.sh

pkgver="$1"
tmpl="$2"

mapfile -t binnames <<<"$(get_binnames "$pkgver")"

while IFS= read -r line; do
	if grep -s "^	source = .*" <<<"$line" >/dev/null; then
		url="$(echo "$line" | grep -o https.*)"
		dir="$(echo "$url" | rev | cut -d '/' -f2- | rev)"

		for binname in "${binnames[@]}"; do
			echo "	source = $dir/$binname"
		done
	elif grep -s "^	sha256sums = .*" >/dev/null <<<"$line"; then
		url="$(echo "$line" | grep -o https.*)"
		dir="$(echo "$url" | rev | cut -d '/' -f2- | rev)"

		for binname in "${binnames[@]}"; do
			echo "	sha256sums = $(get_checksum "$pkgver" "$binname")"
		done
	else
		echo "$line"
	fi
done <"$tmpl"
